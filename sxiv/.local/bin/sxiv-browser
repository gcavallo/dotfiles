#!/usr/bin/env bash

if [[ ! -f $1 ]]; then
	echo "$0: first argument is not a file" >&2
	exit 1
fi

img=$(realpath "$1")
dir=$(dirname "$img")
exp='.*\.(jpe?g|bmp|png|gif)'

declare -A idx
while IFS= read -rd '' file; do
	a[++i]=$file
	idx[$file]=$i
done < <(find -L "$dir" -maxdepth 1 -type f -regextype awk \( -iregex "$exp" -o -samefile "$img" \) -print0 | sort -z)

sxiv -q -n ${idx[$img]} "${@:2}" -- "${a[@]}"
