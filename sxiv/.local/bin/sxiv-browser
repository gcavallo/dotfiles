#!/usr/bin/env bash

if [[ ! -f $1 ]]; then
	echo "$0: first argument is not a file" >&2
	exit 1
fi

img=$(realpath "$1")
dir=$(dirname "$img")
exp='.*\.\(jpe?g\|bmp\|png\|gif\)'

find -L "$dir" -maxdepth 1 -type f \( -iregex "$exp" -o -samefile "$img" \) -print0 \
	| sort -z \
	| tee >(printf %s\\0 -n"$(fgrep -znm1 "$img" | cut -d: -f1)") \
	| xargs -0s"$(getconf ARG_MAX)" sxiv -q "${@:2}"
